<pre><font color="#007f69">patches-own</font><font color="#000000"> [<br />  cooperate?       </font><font color="#5a5a5a">;; patch will cooperate</font><font color="#000000"><br />  old-cooperate?   </font><font color="#5a5a5a">;; patch has cooperated before</font><font color="#000000"><br />  score            </font><font color="#5a5a5a">;; score resulting from interaction of neighboring patches</font><font color="#000000"><br />  color-class      </font><font color="#5a5a5a">;; numeric value from 1= blue, 2= red, 3= green, 4= yellow.</font><font color="#000000"><br />]<br /><br /></font><font color="#007f69">to</font><font color="#000000"> setup<br />  </font><font color="#0000aa">clear-all</font><font color="#000000"><br />  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> [<br />    </font><font color="#0000aa">ifelse</font><font color="#000000"> </font><font color="#660096">random-float</font><font color="#000000"> </font><font color="#963700">1.0</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> (initial-cooperation </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">100</font><font color="#000000">)<br />      [setup-cooperation </font><font color="#963700">true</font><font color="#000000">]<br />      [setup-cooperation </font><font color="#963700">false</font><font color="#000000">]<br />    establish-color<br />  ]<br />  </font><font color="#0000aa">reset-ticks</font><font color="#000000"><br />  update-plot<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> setup-cooperation [value]<br />  </font><font color="#0000aa">set</font><font color="#000000"> cooperate? value<br />  </font><font color="#0000aa">set</font><font color="#000000"> old-cooperate? value<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> go<br />  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> [interact]          </font><font color="#5a5a5a">;; to play with a neighboring patch</font><font color="#000000"><br />  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> [select-strategy]   </font><font color="#5a5a5a">;; adopt the strategy of the neighbor (who had the highest score)</font><font color="#000000"><br />  </font><font color="#0000aa">tick</font><font color="#000000"><br />  update-plot<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> update-plot<br />  </font><font color="#0000aa">set-current-plot</font><font color="#000000"> </font><font color="#963700">&quot;Cooperation/Defection Frequency&quot;</font><font color="#000000"><br />  plot-histogram-helper </font><font color="#963700">&quot;cc&quot;</font><font color="#000000"> </font><font color="#963700">blue</font><font color="#000000"><br />  plot-histogram-helper </font><font color="#963700">&quot;dd&quot;</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000"><br />  plot-histogram-helper </font><font color="#963700">&quot;cd&quot;</font><font color="#000000"> </font><font color="#963700">green</font><font color="#000000"><br />  plot-histogram-helper </font><font color="#963700">&quot;dc&quot;</font><font color="#000000"> </font><font color="#963700">yellow</font><font color="#000000"><br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> plot-histogram-helper [pen-name color-name]<br />  </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> pen-name<br />  </font><font color="#0000aa">histogram</font><font color="#000000"> [color-class] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> color-name]<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> interact  </font><font color="#5a5a5a">;; patch procedure</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> total-cooperaters </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [cooperate?]  </font><font color="#5a5a5a">;; total number neighbors who cooperated</font><font color="#000000"><br />  </font><font color="#0000aa">ifelse</font><font color="#000000"> cooperate?<br />    [</font><font color="#0000aa">set</font><font color="#000000"> score total-cooperaters]                   </font><font color="#5a5a5a">;; cooperator gets score of # of neighbors who cooperated</font><font color="#000000"><br />    [</font><font color="#0000aa">set</font><font color="#000000"> score defection-award </font><font color="#660096">*</font><font color="#000000"> total-cooperaters] </font><font color="#5a5a5a">;; non-cooperator get score of a multiple of the</font><font color="#000000"><br />                                                    </font><font color="#5a5a5a">;; neighbors who cooperated</font><font color="#000000"><br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> select-strategy  </font><font color="#5a5a5a">;; patch procedure</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> old-cooperate? cooperate?<br />  </font><font color="#0000aa">set</font><font color="#000000"> cooperate? [cooperate?] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">max-one-of</font><font color="#000000"> </font><font color="#660096">neighbors</font><font color="#000000"> [score] </font><font color="#5a5a5a">;;choose strategy (cooperate, not cooperate)</font><font color="#000000"><br />                                                            </font><font color="#5a5a5a">;; of neighbor who performed the best</font><font color="#000000"><br />  establish-color<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> establish-color  </font><font color="#5a5a5a">;; patch procedure</font><font color="#000000"><br />  </font><font color="#0000aa">ifelse</font><font color="#000000"> old-cooperate?<br />    [</font><font color="#0000aa">ifelse</font><font color="#000000"> cooperate?<br />      [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">blue</font><font color="#000000"><br />       </font><font color="#0000aa">set</font><font color="#000000"> color-class </font><font color="#963700">1</font><font color="#000000">]<br />      [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">green</font><font color="#000000"><br />       </font><font color="#0000aa">set</font><font color="#000000"> color-class </font><font color="#963700">3</font><font color="#000000">]<br />    ]<br />    [</font><font color="#0000aa">ifelse</font><font color="#000000"> cooperate?<br />      [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">yellow</font><font color="#000000"><br />       </font><font color="#0000aa">set</font><font color="#000000"> color-class </font><font color="#963700">4</font><font color="#000000">]<br />      [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000"><br />       </font><font color="#0000aa">set</font><font color="#000000"> color-class </font><font color="#963700">2</font><font color="#000000">]<br />    ]<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /><br /></font><font color="#5a5a5a">; Copyright 2002 Uri Wilensky.</font><font color="#000000"><br /></font><font color="#5a5a5a">; See Info tab for full copyright and license.</font>
</pre>